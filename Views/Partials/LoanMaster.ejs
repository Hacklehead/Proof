<!DOCTYPE html>

<html>

<head>
<title>Loan Master</title>
<link rel="icon" href="ps32.gif" type="image/gif" sizes="32x32">


</head>
<link rel="stylesheet" href="main.css">
<body onload="myLoad();" style="font-family:arial;">
	  <div class="row">
		<div class="column" style="border-top: 1px solid #ddd;font-family: arial; font-size: 24px; text-align: left; height:32px; background-color:#f2f2f2; color: #000080; padding: 4px 5px 2px 4px;">
			<img src="PequaSoft.png" alt="Forest" style="width:125px">
		</div>
		<div class="column" style="border-top: 1px solid #ddd;font-family: arial; font-size: 24px; text-align: center; height:32px; background-color:#f2f2f2; color: #000080; padding: 4px 5px 2px 4px;">
		  <strong>Loan Master</strong>
		</div>
		<div class="column" style="border-top: 1px solid #ddd;font-family: arial; font-size: 16px; text-align: right; height:32px; background-color:#f2f2f2; color: #000080; padding: 4px 5px 2px 4px;">
		  <label style="color: blue" >User ID: </label><label id="viewUID" style="color: black" >...</label>
		</div>
	  </div>

	  <div style="height:35px; background-color:#000080; padding: 2px 5px 2px 5px;">
		<button id="GoToBackOffice" class="buttony button4" style="float: left; width: 250px; margin-right: 25px;" onclick="window.location.href='/Mainmenu'" ><strong>Main Menu</strong></button>
		
		<button id="GoToBackOffice" class="buttony button4" style="float: left; width: 250px; margin-right: 25px;" onclick="window.location.href='/Quickcalculator'" ><strong>Quick Loan Calculator</strong></button>
	  </div>

<br> <br> <br> 


<section>
  <nav style="float: left; width: 860px; height: 500px; " >

  <button id="GoToBackOffice" class="buttony button33" style="float: center; width: 155px;margin-right: 5px; " onclick="onAddLoan()"  ><strong>Add Loan</strong></button>
  <button id="GoToBackOffice" class="buttony button33" style="float: center; width: 155px;margin-right: 6px; " onclick="onDeleteLoan()" ><strong>Delete Loan</strong></button>
  <button id="GoToBackOffice" class="buttony button33" style="float: center; width: 155px;margin-right: 6px; " onclick="onCopyLoan()" ><strong>Copy Loan</strong></button>
  <button id="GoToBackOffice" class="buttony button33" style="float: center; width: 155px;margin-right: 5px; " onclick="onEditLoan()" ><strong>Edit Loan</strong></button>
  <button id="GoToBackOffice" class="buttony button33" style="float: center; width: 155px; " onclick="onCalcLoan()" ><strong>Calculate Loan</strong></button>
  <br><br>

	<table class="myTable_2" style="width: 100%;" id="myTable_2" >
	
		<thead class="fixedHeader">
			<tr class="header">

			<th width="170">Loan ID</th>
			<th width="160">Balance</th>
			<th width="160">Rate</th>
			<th width="160">Num Pmts</th>
			
			<%if(dataSet.length < 8){ %>
			    <% val = "160" %>
				
            <% } %>
			<%if(dataSet.length >= 8){ %>
				<% val = "176" %>
            <% } %>
						
			<th width="<%= val %>"> Payment</th>
			
			</tr>
		</thead>
   
	<tbody class="scrollContent" id="scroll">
   
	<% for (var i = 0; i < dataSet.length; i++) {  %>
		<% buff=dataSet[i].balance; buff=buff.toString();var pattern = /(-?\d+)(\d{3})/g; buff = buff.replace(pattern, "$1,$2"); buff = buff.replace(pattern, "$1,$2"); buff = buff.replace(pattern, "$1,$2") %>

				
		<tr onclick="myFunction(this)">
		<td width="170"><%= dataSet[i].loanid %></td>
		
		<td id="aa" class="right" width="161"><%= buff %></td>
		<td class="right" width="161"><%= dataSet[i].rate %></td>
		<td class="right" width="161"><%= dataSet[i].numpmts %></td>
		<td class="right" width="161"><%= dataSet[i].payment %></td>
		</tr>  
		
		
  <% } %>
</tbody>		
</table>
	 </nav>

	<article style="max-width: 600px; display: inline-block ">
   
	<p><font size="4" color="#000080"> <strong>Loan Thumbnail</strong></font></p>
    <div style="float: left; width: 150px;" >	
	<label style="color: blue" >Loan ID:</label><br><br>
	<label style="color: blue" >Balance:</label><br><br>
	<label style="color: blue" >Rate:</label><br><br>
	<label style="color: blue" >Num Pmts:</label><br><br>
	<label style="color: blue" >Payment:</label><br><br>

	</div>

	<font size="3" color="black">
    <div style="float: left; width: 200px;  border: none; " >	
	<label style="color: black" id="loanid"></label><br><br>
	<label style="color: black" id="balance"></label><br><br>
	<label style="color: black" id="rate"></label><br><br>
	<label style="color: black" id="numpmts"></label><br><br>
	<label style="color: black" id="pmt"></label><br><br>
	</div>		
	
	<table class="myTable_3" style="width: 100%;" id="myTable_3" hidden>
	
		<thead class="fixedHeader">
			<tr class="header">

			<th width="200">Loan ID</th>
			<th width="180">Balance</th>
			<th width="180">Rate</th>
			<th width="180">Num Pmts</th>
			
			<%if(dataSet.length < 11){ %>
			    <% val = "180" %>
				
            <% } %>
			<%if(dataSet.length >= 11){ %>
				<% val = "196" %>
            <% } %>
						
			<th width="<%= val %>"> Payment</th>
			
			</tr>
		</thead>
   
	<tbody class="scrollContent">
   
	<% for (var i = 0; i < dataSet.length; i++) {  %>
		<tr >
		<td width="200"><%= dataSet[i].loanid %></td>
		<td class="center" width="180"><%= dataSet[i].balance %></td>
		<td class="center" width="180"><%= dataSet[i].rate %></td>
		<td class="center" width="180"><%= dataSet[i].numpmts %></td>
		<td class="center" width="180"><%= dataSet[i].payment %></td>
		</tr>  
		
  <% } %>
</tbody>		
</table>

</article>
</section>

<%- include('partials/addloan') %>



<div id="myModalAdd" class="modal">
	<!-- Modal content -->
	<div class="modal-content">
	  <div class="modal-header">
	  <span class="close">&times;</span>
	  <h2 style="font-family:arial;">Add a Loan</h2>
	  </div>
	  <br>
	  <form action="/newloan" method="POST" id="myNewLoan" >
		  	<div class="modal-body">
	  			<div class="row">
					<div class="column" >
					<p><label id="rundate" style="font-family:arial; padding-bottom: 10px;" for="demo">User Name:</label><br></p>		
					<p><label id="rundate" style="font-family:arial; padding-bottom: 10px;" for="demo">Loan Name:</label><br></p>
				</div> 
				<div class="column"  style="padding-bottom: 3px;">
					<p><input type="text" id="userid"  name="userid" style="width:175px;"><br></p>
					<p><input type="text" id="loanname"  name="loanname" style="width:175px;"><br></p>
				</div>
	  			</div><br><br>
			</div>
		<button class="buttony button3" id="sendbackpmts" onclick="SendAddLoan(1)"><strong>Submit</strong></button>
		
	</form>
	</div>
  </div>

  <div id="myModalCopy" class="modal">
		<!-- Modal content -->
		<div class="modal-content">
		  <div class="modal-header">
		  <span class="close">&times;</span>
		  <h2 style="font-family:arial;">Copy a Loan</h2>
		  </div>
		  <br>
		  <form action="/copyloan" method="POST" id="myCopyLoan" >
				  <div class="modal-body">
					  <div class="row">
						<div class="column" >
						<p><label id="rundate" style="font-family:arial; padding-bottom: 10px;" for="demo">User Name:</label><br></p>		
						<p><label id="rundate" style="font-family:arial; padding-bottom: 10px;" for="demo">Source Loan Name:</label><br></p>
						<p><label id="rundate" style="font-family:arial; padding-bottom: 10px;" for="demo">Destination Loan Name:</label><br></p>
					</div> 
					<div class="column"  style="padding-bottom: 3px;">
						<p><input type="text" id="copyuserid"  name="copyuserid" style="width:175px;"><br></p>
						<p><input type="text" id="srceloanname"  name="srceloanname" style="width:175px;"><br></p>
						<p><input type="text" id="destloanname"  name="destloanname" style="width:175px;"><br></p>
					</div>
					  </div><br><br>
				</div>
			<button class="buttony button3" id="sendbackpmts" onclick="SendCopyLoan(1)"><strong>Submit</strong></button>
		
		</form>
		</div>
	  </div>

	<div id="myModalDelete" class="modal">
		<!-- Modal content -->
		<div class="modal-content">
		  <div class="modal-header">
		  <span class="close">&times;</span>
		  <h2 style="font-family:arial;">Delete a Loan</h2>
		  </div>
		  <br>
		  <form action="/deleteloan" method="POST" id="myDeleteLoan" >
				  <div class="modal-body">
					  <div class="row">
						<div class="column" >
						<p><label id="rundate" style="font-family:arial; padding-bottom: 10px;" for="demo">User Name:</label><br></p>		
						<p><label id="rundate" style="font-family:arial; padding-bottom: 10px;" for="demo">Delete Loan Name:</label><br></p>
					</div> 
					<div class="column"  style="padding-bottom: 3px;">
						<p><input type="text" id="deleteuserid"  name="deleteuserid" style="width:175px;"><br></p>
						<p><input type="text" id="deleteloanname"  name="deleteloanname" style="width:175px;"><br></p>
						
					</div>
					  </div><br><br>
				</div>
			<button class="buttony button3" id="sendbackpmts" onclick="SendCopyLoan(1)"><strong>Submit</strong></button>
		
		</form>
		</div>
	  </div>	  

<script>

var table;

table = document.getElementById("myTable_1");

var i,m,buff;

//\d)(?=(\d{3})+(?!\d))/g
var pattern = /(-?\d+)(\d{3})/;

function myFunction() {

  var input, filter, table, tr, td, i, x;

  input = document.getElementById("myInput");
  filter = input.value.toUpperCase();

  x=document.getElementById("viewOption").innerHTML;

  if (x == 'Collapse'){
                table = document.getElementById("myTable_1");}
                else{
                table = document.getElementById("myTable_2");
                }

  tr = table.getElementsByTagName("tr");

  for (i = 0; i < tr.length; i++) {
    td = tr[i].getElementsByTagName("td")[0];
    if (td) {
      if (td.innerHTML.toUpperCase().indexOf(filter) > -1) {
        tr[i].style.display = "";
      } else {
        tr[i].style.display = "none";
      }
    }      
  }
}

function setViewOption() {

}

function myFunction(x) {

var cell_1 = x.getElementsByTagName("td")[0];
var cell_2 = x.getElementsByTagName("td")[1];
var cell_3 = x.getElementsByTagName("td")[2];
var cell_4 = x.getElementsByTagName("td")[3];
var cell_5 = x.getElementsByTagName("td")[4];

var id = cell_1.innerHTML;
sessionStorage.currentloanid = id;

var balance = cell_2.innerHTML;
balance = balance.replace(/\B(?=(\d{3})+(?!\d))/g, ",");

var rate = cell_3.innerHTML;
rate =  Number(rate).toFixed(4);    

var numpmts = cell_4.innerHTML;
var pmt = cell_5.innerHTML;

document.getElementById("loanid").innerHTML=id;

document.getElementById("balance").innerHTML= balance;  // accounting.formatNumber(balance,2);
document.getElementById("rate").innerHTML=rate;    //accounting.formatNumber(rate,4);
document.getElementById("numpmts").innerHTML=numpmts;
document.getElementById("pmt").innerHTML=pmt;

}

</script>

<script>
var modal = document.getElementById("myModalAdd");
var modalCopy = document.getElementById("myModalCopy");
var modalDelete = document.getElementById("myModalDelete");

var span = document.getElementsByClassName("close")[0];
var span2 = document.getElementsByClassName("close")[1];
var span3 = document.getElementsByClassName("close")[2];

function myLoad() {

sessionStorage.currentloanid = '--';
document.getElementById("loanname").value = '--';
var table = document.getElementById("myTable_2");
var tr = table.getElementsByTagName("tr");
var td, buff, i;

var x=document.getElementById("viewUID").innerHTML=sessionStorage.userid;

if (typeof x === "undefined") {
  window.location.replace("/entry")};

  if (typeof x == "--") {
  window.location.replace("/entry")};

}

function onAddLoan(){
	document.getElementById("userid").value = sessionStorage.userid;
	sessionStorage.currentloanid
	modal.style.display = "block";

//alert('Add Loan');
}

function onCopyLoan(){

document.getElementById("copyuserid").value = sessionStorage.userid;
document.getElementById("srceloanname").value = sessionStorage.currentloanid;

if(sessionStorage.currentloanid != '--'){modalCopy.style.display = "block";}


//alert('Copy Loan');
}

function onDeleteLoan(){
//alert('Delete Loan');

	document.getElementById("deleteuserid").value = sessionStorage.userid;
	document.getElementById("deleteloanname").value = sessionStorage.currentloanid;

if(sessionStorage.currentloanid != '--'){modalDelete.style.display = "block";}

}

function onEditLoan(){
alert('Edit Loan');
}

function onCalcLoan(){
alert('Calculate Loan');
}

function SendAddLoan(parSwitch) {
var table = document.getElementById("scroll");
var tr = table.getElementsByTagName("tr");
var td;
var buff,i;

if (parSwitch == 0){modal.style.display = "none";}
sessionStorage.newloan = document.getElementById("loanname").value;

for (i = 0; i < tr.length; i++) {
	td = tr[i].getElementsByTagName("td")[0];
  	buff=td.innerHTML.toString();
	//alert(buff.toString());
	if (buff == sessionStorage.newloan) {
	alert(sessionStorage.newloan + ' already exists');
  	}      
	}
}

function SendCopyLoan(parSwitch) {
var table = document.getElementById("scroll");
var tr = table.getElementsByTagName("tr");
var td;
var buff,i;

if (parSwitch == 0){modal.style.display = "none";}
sessionStorage.newloan = document.getElementById("copyloanname").value;

for (i = 0; i < tr.length; i++) {
  	td = tr[i].getElementsByTagName("td")[0];
  	buff=td.innerHTML.toString();
  	if (buff == sessionStorage.newloan) {
	alert(sessionStorage.newloan + ' already exists');
  		}      
	}

}

span.onclick = function() {
  modal.style.display = "none";
}

span2.onclick = function() {
  modalCopy.style.display = "none";
}
span3.onclick = function() {
  modalDelete.style.display = "none";
}

</script>
 

<style>

#myTable_1 tr:hover {

  background-color: #7979d2;

  color: white;

}

</style>

 

</body>

</html>

 